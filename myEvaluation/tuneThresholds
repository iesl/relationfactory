key=$1
predictions=$2
out=$3
tunedParams=$out.threshes
tunedOutput=$out.tunedOutput

suffixes=""
pfx=`mktemp`
queryXML=/iesl/canvas/belanger/relationfactory/example2012/query_expanded.xml


thresh=`cut -f9 $predictions | sort -n -r | head -5000 | tail -1`
#for thresh in 3 2 1.5 1 0.5 0.1  0 0.25 -0.1 -0.25 -.5 -1 -1.5
#for thresh in 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9
for thresh in 0.85 0.875 0.9 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 0.995
do
    sfx=t-$thresh
    perl /home/belanger/relationfactory/myEvaluation/mapWithThreshold.pl $predictions $thresh > $pfx.$sfx.pred
    $TAC_ROOT/components/bin/response.sh $queryXML $pfx.$sfx.pred $pfx.$sfx.response
    $TAC_ROOT/components/bin/postprocess.sh $pfx.$sfx.response $queryXML $pfx.$sfx
    suffixes="$suffixes .$sfx"
done

echo /iesl/canvas/belanger/relationfactory/myEvaluation/bin/tunej.sh $key $pfx $suffixes    
/iesl/canvas/belanger/relationfactory/myEvaluation/bin/tunej.sh $key $pfx $suffixes    
cp ${pfx}params $tunedParams
cp ${pfx}tuned $tunedOutput

#rm $pfx*

