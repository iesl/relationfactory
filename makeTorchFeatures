set -e
d=runs/run030415c/

ngram_ext=ngram_directed,skip_exact

for singleSentenceMode in true false
do
for set in train dev
do
	tmp=/tmp/$set.proc
	lab=$d/$set.relation.ss-$singleSentenceMode.feats
	cut -f9 $lab | cut -d" " -f2- > $tmp.lab
	echo tmp.lab `wc -l $tmp.lab`
	for ext in $ngram_ext
	do
		echo $set $ext
		feat=$d/$set.$ext.ss-$singleSentenceMode.feats
		echo feat `wc -l $feat`
		cut -f1-8 $feat > $feat.lhs
		echo lhs `wc -l $feat.lhs`
        	cut -f9 $feat | sed 's|^\+1 ||'  > $tmp.$ext
		paste $tmp.lab $tmp.$ext > $feat.libsvm.tmp
		echo tmp `wc -l $feat.libsvm.tmp `
	done
	rm $tmp*	
done
done

labelList=/tmp/labels

cut -f1 $d/train.$ngram_ext.ss-false.feats.libsvm.tmp | sort -u > $labelList
num=`wc -l $labelList | cut -d" " -f1`
seq 1 $num > $labelList.num
paste $labelList $labelList.num > $d/labelMap.txt
for f in $d/*libsvm.tmp
do
	perl mapLabels.perl $d/labelMap.txt  $f > $d/`basename $f .tmp`
done

trainfile_full=$d/train.$ngram_ext.ss-false.feats.libsvm.tmp 
shuf $trainfile_full > $trainfile_full.shuffle
