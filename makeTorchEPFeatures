d=runs/run020815/
outdir=./processedData
ngram_ext=ngram_directed,skip_exact

singleSentenceMode=true

for set in train dev
do
	for ext in $ngram_ext intertext intertext_short
	do

		feat=$d/$set.$ext.ss-$singleSentenceMode.feats
		echo aggregating $feat
		perl aggregateByEP.pl $feat > $feat.EP
	done
done


labelList=/tmp/labels

set=train
ext=$ngram_ext

cut -f2 $d/$set.$ext.ss-$singleSentenceMode.feats | sort -u > $labelList
num=`wc -l $labelList | cut -d" " -f1`
seq 1 $num > $labelList.num
paste $labelList $labelList.num > $d/labelMap.txt


for set in train dev
do
        for ext in $ngram_ext intertext intertext_short
        do

                feat=$d/$set.$ext.ss-$singleSentenceMode.feats

		cut -f2,9 $feat.EP > $feat.mi.str
		perl mapLabels.perl $d/labelMap.txt  $feat.mi.str | perl -pne  's|^(\S+ )\+1 |$1|'  > $feat.mi
		cut -f1-8 $feat > $feat.lhs
        done
done



