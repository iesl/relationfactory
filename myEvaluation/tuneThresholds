key=$1
predictions=$2
out=$3
tunedParams=$out.threshes
tunedOutput=$out.tunedOutput

suffixes=""
pfx=`mktemp`
queryXML=/iesl/canvas/beroth/tac/runs/run20140314/query_expanded.xml


thresh=`cut -f9 $predictions | sort -n -r | head -5000 | tail -1`
echo 5000th 
for thresh in 5 4 3 2 1 0.5 0.1 
do
    sfx=t-$thresh
    perl /home/belanger/relationfactory/myEvaluation/mapWithThreshold.pl $predictions $thresh > $pfx.$sfx.pred
    $TAC_ROOT/components/bin/response.sh $queryXML $pfx.$sfx.pred $pfx.$sfx.response
    $TAC_ROOT/components/bin/postprocess2013_nolinkstat.sh $pfx.$sfx.response /iesl/canvas/beroth/tac/runs/run20140314/query_expanded.xml /dev/null $pfx.$sfx
    suffixes="$suffixes .$sfx"
done

/iesl/canvas/beroth/tac/evaluation/bin/tunej.sh $key $pfx $suffixes    
cp ${pfx}params $tunedParams
cp ${pfx}tuned $tunedOutput

rm $pfx*

